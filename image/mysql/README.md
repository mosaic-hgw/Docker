## General
This layer can be used to build a MySQL image, but also to add a database to our WildFly image.
One difference to the [official MySQL image](https://hub.docker.com/_/mysql) is the ability to process sql files via the
SQL mount even after initialization.

## Relevant ENV Variables
| Category   | Varaible             | Available values or scheme | Default |
|------------|----------------------|----------------------------|---------|
| Security   | MYSQL_ROOT_PASSWORD  | \<STRING\>                 | root    |
| Logging    | MYSQL_GENERAL_LOG    | 0, 1                       | 0       |
| Logging    | MYSQL_SLOW_QUERY_LOG | 0, 1                       | 0       |
| Optimizing | MYSQL_OPTS           | \<STRING\>                 | -       |

The variable `MYSQL_OPTS` in particular is comparable to `JAVA_OPTS`,
where additional parameters can be specified that are to be taken into account when MySQL is started.
For example, the memory requirement can simply be specified with: `MYSQL_OPTS=--innodb_buffer_pool_size=10G`.


## Relevant Entrypoints
| Path                     | ref. ENV-Variable   | Type      | Default                | Purpose                                                                                                                             |
|--------------------------|---------------------|-----------|------------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| /entrypoint-mysql-sqls   | ENTRY_MYSQL_SQLS    | directory | -                      | All SQL files that are to be executed at the first start for database preparation are placed here.                                  |
| /entrypoint-mysql-data   | ENTRY_MYSQL_DATADIR | directory | -                      | This directory can be mounted in an external volume so that data is not lost after delete container.                                |
| /entrypoint-mysql-my-cnf | ENTRY_MYSQL_MY_CNF  | file      | ${MYSQL_HOME}/my.cnf   | The `my.cnf` file contains all settings that are relevant for the operation of the MySQL database and can be exchanged accordingly. |
| /entrypoint-mysql-socket | ENTRY_MYSQL_SOCKET  | directory | -                      | The MySQL socket is only relevant for accessing the database if no port is available.                                               |
| /entrypoint-mysql-logs   | ENTRY_MYSQL_LOGS    | Symlink   | /entrypoint-logs/mysql | All logs generated by the MySQL service are stored here.                                                                            |


## Usage Docker
```shell
# build java-image
> cd images/mysql
> docker build --tag="mosaicgreifswald/debian" .

# "versions" shows all installed tools and components, with their versions
> docker run --rm mosaicgreifswald/mysql versions
  last updated               : 2024-03-05 09:50:18
  Distribution               : Debian GNU/Linux 12.5
  MySQL-Server               : 8.3.0
  
# "entrypoints" lists all registered entrypoints
> docker run --rm mosaicgreifswald/mysql entrypoints
  ENTRY_LOGS                 : /entrypoint-logs
  ENTRY_USAGE                : /entrypoint-help-and-usage
  ENTRY_MYSQL_DATADIR        : /entrypoint-mysql-data
  ENTRY_MYSQL_SQLS           : /entrypoint-mysql-sqls
  ENTRY_MYSQL_MY_CNF         : /entrypoint-mysql-my-cnf
  ENTRY_MYSQL_SOCKET         : /entrypoint-mysql-socket
  ENTRY_MYSQL_LOGS           : /entrypoint-mysql-logs

# simple start with your init-sqls and mysql-configuration, as well as locally stored db-data and logs
> docker run --rm -it \
    -e MYSQL_ROOT_PASSWORD=top-secret \
    -p 3306:3306 \
    -v /path/to/your/db-data:/entrypoint-mysql-data \
    -v /path/to/your/sqls:/entrypoint-mysql-sqls \
    -v /path/to/your/my.cnf:/entrypoint-mysql-my-cnf \
    -v /path/to/your/logs:/entrypoint-mysql-logs \
    mosaicgreifswald/mysql
```


## Usage with Docker compose
```yml
# docker-compose.yml
version: '3'
services:
  mysql:
    image: mosaicgreifswald/mysql
    ports:
      - 3306:3306
    environment:
      MYSQL_ROOT_PASSWORD: top-secret
    env_file:
      - ./envs/wf_commons.env
    volumes:
      - ./db-data:/entrypoint-mysql-data
      - ./sqls:/entrypoint-mysql-sqls
      - ./my.cnf:/entrypoint-mysql-my-cnf
      - ./logs:/entrypoint-mysql-logs
```

## Additional files
```shell
# see all additional files
> docker run --rm -it mosaicgreifswald/mysql bash -c "cd /entrypoint-help-and-usage; ls -lah; bash"

# or copy all to local host
> docker run --rm -v "$(pwd)":"$(pwd)" mosaicgreifswald/mysql bash -c "cp -R /entrypoint-help-and-usage $(pwd)/help-and-usage"
```
You will receive the following directory-tree and can start playing immediately:
```
├─┬─ layer-readme/
│ ├─── README-debian.md
│ └─── README-mysql.md
└─┬─ examples/
  ├─┬─ compose-mysql-empty/
  │ ├─── db-data/
  │ ├─┬─ envs/
  │ │ └─── ttp_mysql.env
  │ ├─── logs/
  │ ├─── sqls/
  │ ├─── my.cnf
  │ └─── docker-compose.yml
  └─┬─ pure-envs/
    ├─── debian.env
    └─── ttp_mysql.env
```


## Current Software-Versions on this Image
| Date               | Tags                                                                                                                                                     | Changes                                              |
|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| 2024-06-18         | `8.4.0`, `8`, `latest` ([Dockerfile](https://github.com/mosaic-hgw/Docker/blob/8ca53f507d18361bca5fc3e824630f7a813590a8/image/mysql/Dockerfile.mysql.8)) | **MySQL-Server** 8.4.0                               |
| 2024-03-05<br><br> | `8.3.0` ([Dockerfile](https://github.com/mosaic-hgw/Docker/blob/5c561547b1f3f6edf02a8a84c786e48868298d33/image/mysql/Dockerfile.mysql.8))<br><br>        | **Debian** 12.5 "bookworm"<br>**MySQL-Server** 8.3.0 |
