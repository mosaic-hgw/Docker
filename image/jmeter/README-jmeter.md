### Der jMeter-Layer
#### 1 Allgemeines
This layer is only used to automatically execute tests without a GUI.
The layer can be created to generate a separate jMeter image, which is integrated via Docker-Compose,
or a complete test image, which is based on a `wildfly-db` image.

#### Relevant ENV Variables
| Category   | Varaible           | Available values or scheme      | Default                                                       |
|------------|--------------------|---------------------------------|---------------------------------------------------------------|
| Logging    | JMETER_LOG_TO_FILE | ERROR, WARN, INFO, DEBUG, TRACE | INFO                                                          |
| Logging    | JMETER_LOG_LEVEL   | TRUE, FALSE                     | FALSE                                                         |
| Optimizing | GC_ALGO            | \<STRING\>                      | -XX:+UseG1GC -XX:MaxGCPauseMillis=100 -XX:G1ReservePercent=20 |
| Optimizing | HEAP               | \<STRING\>                      | -Xms1g -Xmx1g -XX:MaxMetaspaceSize=256m                       |

#### Relevant Entrypoints
| Path                          | ref. ENV-Variable       | Type                               | Purpose                                                                                                                            |
|-------------------------------|-------------------------|------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| /entrypoint-logs              | ENTRY_LOGS              | folder                             | All further layers can store their own log files here in subdirectories.                                                           |
| /entrypoint-java-cacerts      | ENTRY_JAVA_CACERTS      | file                               | The entrypoint can be used to store its own cacerts, e.g. containing public-keys of server-certificates for specific web requests. |
| /entrypoint-jmeter-testfiles  | ENTRY_JMETER_TESTS      | Directory                          | All JMX files that are to be started via jMeter are stored here.                                                                   |
| /entrypoint-jmeter-properties | ENTRY_JMETER_PROPERTIES | Directory                          | In addition, the properties files that are relevant for the start and correct execution of the tests can be stored here.           |
| /entrypoint-jmeter-logs       | ENTRY_JMETER_LOGS       | Symlink to /entrypoint-logs/jmeter | All logs generated by jMeter are stored here.                                                                                      |

## Usage Docker
```shell
# build java-image
> cd images/mysql
> docker build --tag="mosaicgreifswald/jmeter" .

# "versions" shows all installed tools and components, with their versions
> docker run --rm mosaicgreifswald/jmeter versions
  last updated               : 2024-07-22 14:07:51
  Distribution               : Debian GNU/Linux 12.6
  zulu-jre                   : 21.0.4
  jMeter                     : 5.6.3
  jMeter-Plugins             : 1.4.0
  java-json                  : 20240303
  jmeter-prometheus-plugin   : 0.7.1
  
# "entrypoints" lists all registered entrypoints
> docker run --rm mosaicgreifswald/jmeter entrypoints
  ENTRY_LOGS                 : /entrypoint-logs
  ENTRY_JAVA_CACERTS         : /entrypoint-java-cacerts
  ENTRY_JMETER_TESTS         : /entrypoint-jmeter-testfiles
  ENTRY_JMETER_PROPERTIES    : /entrypoint-jmeter-properties
  ENTRY_JMETER_LOGS          : /entrypoint-jmeter-logs

# simple start with your test- and optional property-files, as well as locally stored logs
> docker run --rm -it \
    -v /path/to/your/jmx-files:/entrypoint-jmeter-testfiles \
    -v /path/to/your/property-files:/entrypoint-jmeter-properties \
    -v /path/to/your/logs:/entrypoint-jmeter-logs \
    mosaicgreifswald/jmeter
```


## Usage with Docker compose
```yml
# docker-compose.yml
version: '3'
services:
  application:
    image: yourcompany/application
    ports:
      - 8080:8080
  jmeter:
    image: mosaicgreifswald/jmeter
    depends_on:
      - application
    env_file:
      - ./envs/jmeter.env
    volumes:
      - ./jmeter-tests:/entrypoint-jmeter-testfiles
      - ./jmeter-props:/entrypoint-jmeter-properties
      - ./logs:/entrypoint-jmeter-logs
    entrypoint: /bin/bash
    command: -c "./wait-for-it.sh application:8080 -t 60 && ./run.sh"
```

## Additional files
```shell
# see all additional files
> docker run --rm -it mosaicgreifswald/jmeter bash -c "cd /entrypoint-help-and-usage; ls -lah; bash"

# or copy all to local host
> docker run --rm -v "$(pwd)":"$(pwd)" mosaicgreifswald/jmeter bash -c "cp -R /entrypoint-help-and-usage $(pwd)/help-and-usage"
```
You will receive the following directory-tree and can start playing immediately:
```
├─┬─ layer-readme/
│ ├─── README-debian.md
│ ├─── README-jmeter.md
│ └─── README-zulujre.md
└─┬─ examples/
  ├─┬─ compose-jmeter-empty/
  │ ├─┬─ envs/
  │ │ └─── jmeter.env
  │ ├─┬─ jmeter-tests/
  │ │ └─── wildfly-test.jmx
  │ ├─┬─ jmeter-props/
  │ │ └─── test.properties
  │ ├─── logs/
  │ └─── docker-compose.yml
  └─┬─ pure-envs/
    ├─── debian.env
    ├─── jmeter.env
    └─── zulujre.env
```


## Current Software-Versions on this Image
| Date                   | Tags                                                                                                                                                                 | Changes                                                                    |
|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
| 2024-07-22<br><br><br> | `5.6.3`, `5`, `latest` ([Dockerfile](https://github.com/mosaic-hgw/Docker/blob/ac36ede7359683a8d5b9c8c81c8b1bb28d4bfe55/image/mysql/Dockerfile.mysql.8))<br><br><br> | **Debian** 12.6 "bookworm"<br>**openJRE** 21.0.4<br>**MySQL-Server** 8.4.0 |
| 2024-03-05<br><br>     | `5.6.3` ([Dockerfile](https://github.com/mosaic-hgw/Docker/blob/5c561547b1f3f6edf02a8a84c786e48868298d33/image/mysql/Dockerfile.mysql.8))<br><br>                    | **Debian** 12.5 "bookworm"<br>**MySQL-Server** 8.3.0                       |
